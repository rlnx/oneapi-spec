

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>task_arena Class and this_task_arena Namespace &mdash; oneAPI Specification 0.6.1 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../../_static/favicons.png"/>
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/language_data.js"></script>
        <script src="../../../../_static/custom.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="task_scheduler_observer" href="task_scheduler_observer.html" />
    <link rel="prev" title="task_group_context" href="task_group_context.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="https://oneapi.com" class="icon icon-home"> oneAPI Specification
          

          
            
            <img src="../../../../_static/oneAPI-rgb-rev-100.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.6.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../architecture.html">Software Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../library-interop.html">Library Interoperability</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../elements.html">oneAPI Elements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dpcpp/source/index.html">DPC++ (DPC++)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneDPL/source/index.html">oneAPI DPC++ Library (oneDPL)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneDNN/source/index.html">oneAPI Deep Neural Network Library (oneDNN)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneCCL/source/index.html">oneAPI Collective Communications Library (oneCCL)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../l0/source/index.html">oneAPI Level Zero (Level Zero)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneDAL/source/index.html">oneAPI Data Analytics Library (oneDAL)</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../nested-index.html">oneAPI Threading Building Blocks (oneTBB)</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../nested-gen-info.html">General Information</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../nested-interfaces.html">oneTBB Interfaces</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../configuration.html">Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../algorithms.html">Algorithms</a></li>
<li class="toctree-l3"><a class="reference internal" href="../flow_graph.html">Flow Graph</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../task_scheduler.html">Task Scheduler</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="fpu_settings.html">Floating-point Settings</a></li>
<li class="toctree-l4"><a class="reference internal" href="task_group_context.html">task_group_context</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">task_arena Class and this_task_arena Namespace</a></li>
<li class="toctree-l4"><a class="reference internal" href="task_scheduler_observer.html">task_scheduler_observer</a></li>
<li class="toctree-l4"><a class="reference internal" href="task_groups.html">Task Groups</a></li>
<li class="toctree-l4"><a class="reference internal" href="tbb_global_control.html">global_control Class</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../containers.html">Containers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../thread_local_storage.html">Thread Local Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exceptions.html">Exceptions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../nested-aux-interfaces.html">oneTBB Auxiliary Interfaces</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneVPL/source/index.html">oneAPI Video Processing Library (oneVPL)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneMKL/source/index.html">oneAPI Math Kernel Library (oneMKL)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contributors.html">Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../versions.html">HTML and PDF Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notices.html">Legal Notices and Disclaimers</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">oneAPI Specification</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">oneAPI Specification</a> &raquo;</li>
        
          
          <li><a href="../nested-index.html">oneAPI Threading Building Blocks (oneTBB)</a> </li>
          
        
          
        
          
        
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/oneapi-src/oneapi-spec/blob/master/source/elements/oneTBB/source/task_scheduler/task_arena_cls.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="task-arena-class-and-this-task-arena-namespace">
<h1>task_arena Class and this_task_arena Namespace<a class="headerlink" href="#task-arena-class-and-this-task-arena-namespace" title="Permalink to this headline">¶</a></h1>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>A class that represents an explicit, user-managed task scheduler arena, and a namespace
for functions applicable to the current arena.</p>
</div>
<div class="section" id="syntax">
<h2>Syntax<a class="headerlink" href="#syntax" title="Permalink to this headline">¶</a></h2>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">task_arena</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="header">
<h2>Header<a class="headerlink" href="#header" title="Permalink to this headline">¶</a></h2>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;tbb/task_arena.h&quot;</span><span class="cp"></span>
</pre></div>
</div>
</div>
<div class="section" id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>A <code class="docutils literal notranslate"><span class="pre">task_arena</span></code> class represents a place where threads may share and execute tasks.</p>
<p>The number of threads that may simultaneously execute tasks in a task_arena is limited
by its concurrency level. The concurrency level affects only that arena, and is not affected
by previous <code class="docutils literal notranslate"><span class="pre">task_scheduler_init</span></code> specifications.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The total number of threads that the scheduler may use is limited by whichever is largest:
the default number of threads for the machine or the value specified for the first task
scheduler initialization. Therefore the number of threads assigned to a task_arena will
never exceed that maximum value, regardless of its concurrency level. Moreover, a task_arena
might not get the specified number of threads even if it is lower than the allowed maximum.</p>
</div>
<p>Each user thread that explicitly or implicitly initializes the task scheduler creates and
uses an implicit internal task arena object. The tasks spawned or enqueued into one arena
cannot be executed in another arena.</p>
<p>A <code class="docutils literal notranslate"><span class="pre">task_arena</span></code> instance also holds a reference to such internal
representation, but does not fully control its lifetime. The internal representation cannot
be destroyed while it contains tasks or other threads reference it.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">task_arena</span></code> constructors do not create an internal arena object.
It may already exist in case of the “attaching” constructor, otherwise it is created
by explicit call to <code class="docutils literal notranslate"><span class="pre">task_arena::initialize</span></code> or lazily on first use.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>oneAPI Threading Building Blocks does not allocate an implicit
arena object for the current thread when dealing with an explicit arena object represented
by <code class="docutils literal notranslate"><span class="pre">task_arena</span></code>. But, a subsequent scheduler initialization in the same
thread will use default settings, regardless of the number of threads specified for
<code class="docutils literal notranslate"><span class="pre">task_scheduler_init</span></code>. This provides backward compatibility with previous
TBB releases where a call to any method related to the task scheduler initialized
the scheduler for the current thread, including creation of an implicit arena object.</p>
</div>
<p>The namespace <code class="docutils literal notranslate"><span class="pre">this_task_arena</span></code> contains global functions for interaction
with the arena (either explicit <code class="docutils literal notranslate"><span class="pre">task_arena</span></code> or implicit arena object)
currently used by the calling thread.</p>
</div>
<div class="section" id="members">
<h2>Members<a class="headerlink" href="#members" title="Permalink to this headline">¶</a></h2>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="n">tbb</span> <span class="p">{</span>
    <span class="k">class</span> <span class="nc">task_arena</span> <span class="p">{</span>
    <span class="k">public</span><span class="o">:</span>
        <span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">automatic</span> <span class="o">=</span> <span class="n">implementation</span><span class="o">-</span><span class="n">defined</span><span class="p">;</span>
        <span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">not_initialized</span> <span class="o">=</span> <span class="n">implementation</span><span class="o">-</span><span class="n">defined</span><span class="p">;</span>
        <span class="k">struct</span> <span class="n">attach</span> <span class="p">{};</span>

        <span class="n">task_arena</span><span class="p">(</span><span class="kt">int</span> <span class="n">max_concurrency</span> <span class="o">=</span> <span class="n">automatic</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">reserved_for_masters</span> <span class="o">=</span> <span class="mi">1</span><span class="p">);</span>
        <span class="n">task_arena</span><span class="p">(</span><span class="k">const</span> <span class="n">task_arena</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">);</span>
        <span class="k">explicit</span> <span class="nf">task_arena</span><span class="p">(</span><span class="n">task_arena</span><span class="o">::</span><span class="n">attach</span><span class="p">);</span>
        <span class="o">~</span><span class="n">task_arena</span><span class="p">();</span>

        <span class="kt">void</span> <span class="nf">initialize</span><span class="p">();</span>
        <span class="kt">void</span> <span class="nf">initialize</span><span class="p">(</span><span class="kt">int</span> <span class="n">max_concurrency</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">reserved_for_masters</span> <span class="o">=</span> <span class="mi">1</span><span class="p">);</span>
        <span class="kt">void</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">task_arena</span><span class="o">::</span><span class="n">attach</span><span class="p">);</span>
        <span class="kt">void</span> <span class="nf">terminate</span><span class="p">();</span>

        <span class="kt">bool</span> <span class="nf">is_active</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
        <span class="kt">int</span> <span class="nf">max_concurrency</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>

        <span class="c1">// Supported until C++11</span>
        <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">F</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="n">execute</span><span class="p">(</span><span class="n">F</span><span class="o">&amp;</span> <span class="n">f</span><span class="p">);</span>
        <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">F</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="n">execute</span><span class="p">(</span><span class="k">const</span> <span class="n">F</span><span class="o">&amp;</span> <span class="n">f</span><span class="p">);</span>
        <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">F</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="n">enqueue</span><span class="p">(</span><span class="k">const</span> <span class="n">F</span><span class="o">&amp;</span> <span class="n">f</span><span class="p">);</span>
        <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">F</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="n">enqueue</span><span class="p">(</span><span class="k">const</span> <span class="n">F</span><span class="o">&amp;</span> <span class="n">f</span><span class="p">,</span> <span class="n">priority_t</span> <span class="n">p</span><span class="p">);</span>

        <span class="c1">// Supported since C++11</span>
        <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">F</span><span class="o">&gt;</span> <span class="k">auto</span> <span class="n">execute</span><span class="p">(</span><span class="n">F</span><span class="o">&amp;</span> <span class="n">f</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="k">decltype</span><span class="p">(</span><span class="n">f</span><span class="p">());</span>
        <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">F</span><span class="o">&gt;</span> <span class="k">auto</span> <span class="n">execute</span><span class="p">(</span><span class="k">const</span> <span class="n">F</span><span class="o">&amp;</span> <span class="n">f</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="k">decltype</span><span class="p">(</span><span class="n">f</span><span class="p">());</span>
        <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">F</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="n">enqueue</span><span class="p">(</span><span class="n">F</span><span class="o">&amp;&amp;</span> <span class="n">f</span><span class="p">);</span>
        <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">F</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="n">enqueue</span><span class="p">(</span><span class="n">F</span><span class="o">&amp;&amp;</span> <span class="n">f</span><span class="p">,</span> <span class="n">priority_t</span> <span class="n">p</span><span class="p">);</span>

        <span class="k">static</span> <span class="kt">int</span> <span class="nf">current_thread_index</span><span class="p">();</span> <span class="c1">// deprecated</span>
    <span class="p">};</span>
    <span class="k">namespace</span> <span class="n">this_task_arena</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">current_thread_index</span><span class="p">();</span>
        <span class="kt">int</span> <span class="nf">max_concurrency</span><span class="p">();</span>

        <span class="c1">// Supported until C++11</span>
        <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">F</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="n">isolate</span><span class="p">(</span><span class="n">F</span><span class="o">&amp;</span> <span class="n">f</span><span class="p">);</span>
        <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">F</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="n">isolate</span><span class="p">(</span><span class="k">const</span> <span class="n">F</span><span class="o">&amp;</span> <span class="n">f</span><span class="p">);</span>

        <span class="c1">// Supported since C++11</span>
        <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">F</span><span class="o">&gt;</span> <span class="k">auto</span> <span class="n">isolate</span><span class="p">(</span><span class="n">F</span><span class="o">&amp;</span> <span class="n">f</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="k">decltype</span><span class="p">(</span><span class="n">f</span><span class="p">());</span>
        <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">F</span><span class="o">&gt;</span> <span class="k">auto</span> <span class="n">isolate</span><span class="p">(</span><span class="k">const</span> <span class="n">F</span><span class="o">&amp;</span> <span class="n">f</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="k">decltype</span><span class="p">(</span><span class="n">f</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>The following example runs two <code class="docutils literal notranslate"><span class="pre">parallel_for</span></code> loops concurrently; one that is
scalable and one that is not. The non-scalable loop is limited to at most 2 threads so that
the majority of the threads can be saved for the more scalable loop. It uses
<code class="docutils literal notranslate"><span class="pre">task_group</span></code> to wait for a specific subset of tasks.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">tbb</span><span class="o">::</span><span class="n">task_scheduler_init</span> <span class="n">def_init</span><span class="p">;</span> <span class="c1">// Use the default number of threads.</span>
<span class="n">tbb</span><span class="o">::</span><span class="n">task_arena</span> <span class="n">limited</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>        <span class="c1">// No more than 2 threads in this arena.</span>
<span class="n">tbb</span><span class="o">::</span><span class="n">task_group</span> <span class="n">tg</span><span class="p">;</span>

<span class="n">limited</span><span class="p">.</span><span class="n">execute</span><span class="p">([</span><span class="o">&amp;</span><span class="p">]{</span> <span class="c1">// Use at most 2 threads for this job.</span>
    <span class="n">tg</span><span class="p">.</span><span class="n">run</span><span class="p">([]{</span> <span class="c1">// run in task group</span>
        <span class="n">tbb</span><span class="o">::</span><span class="n">parallel_for</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">unscalable_work</span><span class="p">());</span>
    <span class="p">});</span>
<span class="p">});</span>

<span class="c1">// Run another job concurrently with the loop above.</span>
<span class="c1">// It can use up to the default number of threads.</span>
<span class="n">tbb</span><span class="o">::</span><span class="n">parallel_for</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">scalable_work</span><span class="p">());</span>

<span class="c1">// Wait for completion of the task group in the limited arena.</span>
<span class="n">limited</span><span class="p">.</span><span class="n">execute</span><span class="p">([</span><span class="o">&amp;</span><span class="p">]{</span> <span class="n">tg</span><span class="p">.</span><span class="n">wait</span><span class="p">();</span> <span class="p">});</span>
</pre></div>
</div>
<p>The following table provides additional information on the members of the class <code class="docutils literal notranslate"><span class="pre">task_arena</span></code>.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 1%" />
<col style="width: 99%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="2"><p>Member, Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="2"><dl>
<dt><code class="docutils literal notranslate"><span class="pre">task_arena(int</span> <span class="pre">max_concurrency</span> <span class="pre">=</span> <span class="pre">automatic,</span> <span class="pre">unsigned</span> <span class="pre">reserved_for_masters</span> <span class="pre">=</span> <span class="pre">1)</span></code></dt><dd><p>Creates a <code class="docutils literal notranslate"><span class="pre">task_arena</span></code> with a certain concurrency limit
(<code class="docutils literal notranslate"><span class="pre">max_concurrency</span></code>). Some portion of the limit can be
reserved for application threads with <code class="docutils literal notranslate"><span class="pre">reserved_for_masters</span></code>.
The amount for reservation cannot exceed the limit.</p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>If <code class="docutils literal notranslate"><span class="pre">max_concurrency</span></code> and <code class="docutils literal notranslate"><span class="pre">reserved_for_masters</span></code> are
explicitly set to be equal and greater than 1, TBB worker threads will never
join the arena. As a result, the execution guarantee for enqueued tasks is not valid
in such arena. Do not use <code class="docutils literal notranslate"><span class="pre">task_arena::enqueue()</span></code> and
<code class="docutils literal notranslate"><span class="pre">task::enqueue()</span></code> with an arena set to have no worker threads.</p>
</div>
</dd>
</dl>
</td>
</tr>
<tr class="row-odd"><td colspan="2"><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">static</span> <span class="pre">const</span> <span class="pre">int</span> <span class="pre">automatic</span></code></dt><dd><p>When passed as <code class="docutils literal notranslate"><span class="pre">max_concurrency</span></code> to the above constructor, arena
concurrency will be automatically set based on the hardware configuration.</p>
</dd>
</dl>
</td>
</tr>
<tr class="row-even"><td colspan="2"><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">static</span> <span class="pre">const</span> <span class="pre">int</span> <span class="pre">not_initialized</span></code></dt><dd><p>When returned by a method or function, indicates that there is no active arena
or that the arena object has not yet been initialized.</p>
</dd>
</dl>
</td>
</tr>
<tr class="row-odd"><td colspan="2"><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">task_arena(const</span> <span class="pre">task_arena&amp;)</span></code></dt><dd><p>Copies settings from another <code class="docutils literal notranslate"><span class="pre">task_arena</span></code> instance.</p>
</dd>
</dl>
</td>
</tr>
<tr class="row-even"><td colspan="2"><dl>
<dt><code class="docutils literal notranslate"><span class="pre">explicit</span> <span class="pre">task_arena(task_arena::attach)</span></code></dt><dd><p>Creates an instance of <code class="docutils literal notranslate"><span class="pre">task_arena</span></code> that is connected
to the internal arena currently used by the calling thread. If no such arena
exists yet, creates a <code class="docutils literal notranslate"><span class="pre">task_arena</span></code> with default parameters.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Unlike other constructors, this one automatically initializes
the new <code class="docutils literal notranslate"><span class="pre">task_arena</span></code> when connecting to an already existing arena.</p>
</div>
</dd>
</dl>
</td>
</tr>
<tr class="row-odd"><td colspan="2"><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">~task_arena()</span></code></dt><dd><p>Removes the reference to the internal arena representation, and destroys the
<code class="docutils literal notranslate"><span class="pre">task_arena</span></code> instance. Not thread safe w.r.t. concurrent
invocations of other methods.</p>
</dd>
</dl>
</td>
</tr>
<tr class="row-even"><td colspan="2"><dl>
<dt><code class="docutils literal notranslate"><span class="pre">initialize</span></code></dt><dd><p><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">initialize()</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">initialize(int</span> <span class="pre">max_concurrency,</span> <span class="pre">unsigned</span> <span class="pre">reserved_for_masters</span> <span class="pre">=</span> <span class="pre">1)</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">initialize(task_arena::attach)</span></code></p>
<p>Performs actual initialization of internal arena representation. If arguments are
specified, they override previous arena parameters. If an instance of class
<code class="docutils literal notranslate"><span class="pre">task_arena::attach</span></code> is specified as the argument, and there exists
an internal arena currently used by the calling thread, the method ignores arena
parameters and connects <code class="docutils literal notranslate"><span class="pre">task_arena</span></code> to that internal arena.
The method has no effect when called for an already initialized arena.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>After the call to <code class="docutils literal notranslate"><span class="pre">initialize</span></code>, the arena parameters
are fixed and cannot be changed.</p>
</div>
</dd>
</dl>
</td>
</tr>
<tr class="row-odd"><td colspan="2"><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">terminate()</span></code></dt><dd><p>Removes the reference to the internal arena representation without destroying the
task_arena object, which can then be re-used. Not thread safe w.r.t. concurrent
invocations of other methods.</p>
</dd>
</dl>
</td>
</tr>
<tr class="row-even"><td colspan="2"><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">is_active()</span> <span class="pre">const</span></code></dt><dd><p>Returns <code class="docutils literal notranslate"><span class="pre">true</span></code> if the arena has been initialized,
<code class="docutils literal notranslate"><span class="pre">false</span></code> otherwise.</p>
</dd>
</dl>
</td>
</tr>
<tr class="row-odd"><td colspan="2"><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">max_concurrency()</span> <span class="pre">const</span></code></dt><dd><p>Returns the concurrency level of the arena.
Does not require the arena to be initialized and does not perform initialization.</p>
</dd>
</dl>
</td>
</tr>
<tr class="row-even"><td colspan="2"><dl>
<dt><code class="docutils literal notranslate"><span class="pre">enqueue</span></code></dt><dd><p><em>Until C++11:</em> <code class="docutils literal notranslate"><span class="pre">template&lt;F&gt;</span> <span class="pre">void</span> <span class="pre">enqueue(const</span> <span class="pre">F&amp;</span> <span class="pre">f)</span></code></p>
<p><em>Since C++11:</em> <code class="docutils literal notranslate"><span class="pre">template&lt;F&gt;</span> <span class="pre">void</span> <span class="pre">enqueue(F&amp;&amp;</span> <span class="pre">f)</span></code></p>
<p>Enqueues a task into the arena to process the specified functor (which is copied or moved
into the task), and immediately returns.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The method does not require the calling thread to join the arena; i.e. any number
of threads outside of the arena can submit work to it without blocking.</p>
</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>There is no guarantee that tasks enqueued into an arena execute concurrently with
respect to any other tasks there.</p>
</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>An exception thrown and not caught in the functor results in undefined behavior.</p>
</div>
</dd>
</dl>
</td>
</tr>
<tr class="row-odd"><td colspan="2"><dl>
<dt><code class="docutils literal notranslate"><span class="pre">enqueue</span></code> with priority</dt><dd><p><em>Until C++11:</em> <code class="docutils literal notranslate"><span class="pre">template&lt;F&gt;</span> <span class="pre">void</span> <span class="pre">enqueue(const</span> <span class="pre">F&amp;</span> <span class="pre">f,</span> <span class="pre">priority_t)</span></code></p>
<p><em>Since C++11:</em> <code class="docutils literal notranslate"><span class="pre">template&lt;F&gt;</span> <span class="pre">void</span> <span class="pre">enqueue(F&amp;&amp;</span> <span class="pre">f,</span> <span class="pre">priority_t)</span></code></p>
<p>Enqueues a task with specified task priority. Is similar to
<code class="docutils literal notranslate"><span class="pre">enqueue(f)</span></code> in all other ways.</p>
</dd>
</dl>
</td>
</tr>
<tr class="row-even"><td colspan="2"><dl>
<dt><code class="docutils literal notranslate"><span class="pre">execute</span></code></dt><dd><p><em>Until C++11:</em></p>
<p><code class="docutils literal notranslate"><span class="pre">template&lt;F&gt;</span> <span class="pre">void</span> <span class="pre">execute(F&amp;)</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">template&lt;F&gt;</span> <span class="pre">void</span> <span class="pre">execute(const</span> <span class="pre">F&amp;)</span></code></p>
<p><em>Since C++11:</em></p>
<p><code class="docutils literal notranslate"><span class="pre">template&lt;F&gt;</span> <span class="pre">auto</span> <span class="pre">execute(F&amp;)</span> <span class="pre">-&gt;</span> <span class="pre">decltype(f())</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">template&lt;F&gt;</span> <span class="pre">auto</span> <span class="pre">execute(const</span> <span class="pre">F&amp;)</span> <span class="pre">-&gt;</span> <span class="pre">decltype(f())</span></code></p>
<p>Executes the specified functor in the arena. Since C++11 the function returns
the value returned by the functor.</p>
<p>The calling thread joins the arena if possible, and executes the functor.
Upon return it restores the previous task scheduler state
and floating-point settings.</p>
<p>If joining the arena is not possible, the call wraps the functor into a task,
enqueues it into the arena, waits using an OS kernel synchronization object
for another opportunity to join, and finishes after the task completion.</p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Joining an arena (B) for the second time indirectly (like
<code class="docutils literal notranslate"><span class="pre">B.execute([]{</span> <span class="pre">A.execute([]{</span> <span class="pre">B.execute(f);</span> <span class="pre">});</span> <span class="pre">});</span></code>)
reduces effective concurrency of this arena and thus may lead to deadlock.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Any number of threads outside of the arena can submit work to the arena and be
blocked. However, only the maximal number of threads specified for the arena can
participate in executing the work.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">execute</span></code> may decrement the arena demand for worker threads,
causing a worker to leave, and thereby freeing a slot for the calling thread.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>An exception thrown in the functor will be captured and re-thrown from
<code class="docutils literal notranslate"><span class="pre">execute</span></code>. If exact exception propagation is unavailable or
disabled, the exception will be wrapped into
<code class="docutils literal notranslate"><span class="pre">tbb::captured_exception</span></code> even for the same thread.</p>
</div>
</dd>
</dl>
</td>
</tr>
<tr class="row-odd"><td colspan="2"><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">static</span> <span class="pre">int</span> <span class="pre">current_thread_index()</span></code></dt><dd><p><strong>Deprecated</strong>.
Is equivalent to <code class="docutils literal notranslate"><span class="pre">this_task_arena::current_thread_index()</span></code>
(see below) except that it returns -1 if the calling thread has not yet
initialized the task scheduler.</p>
</dd>
</dl>
</td>
</tr>
<tr class="row-even"><td></td>
<td></td>
</tr>
</tbody>
</table>
<p>The next table provides information on the members of the namespace <code class="docutils literal notranslate"><span class="pre">this_task_arena</span></code>.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 1%" />
<col style="width: 99%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="2"><p>Member, Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="2"><dl>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">current_thread_index()</span></code></dt><dd><p>Returns the thread index in a task arena currently used by the calling
thread, or <code class="docutils literal notranslate"><span class="pre">task_arena::not_initialized</span></code> if the thread has not yet
initialized the task scheduler.</p>
<p>A thread index is an integer number between 0 and the arena concurrency level.
Thread indexes are assigned to both application (master) threads and worker threads
on joining an arena and are kept until exiting the arena. Indexes of threads that
share an arena are unique - i.e. no two threads within the arena may have the same
index at the same time - but not necessarily consecutive.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Since a thread may exit the arena at any time if it does not execute a task, the
index of a thread may change between any two tasks, even those belonging to the
same task group or algorithm.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Threads that use different arenas may have the same current index value.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Joining a nested arena in <code class="docutils literal notranslate"><span class="pre">execute()</span></code> may change current index
value while preserving the index in the outer arena which will be restored on
return.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This method can be used, for example, by <code class="docutils literal notranslate"><span class="pre">task_scheduler_observer</span></code>
to pin threads entering an arena to specific hardware.</p>
</div>
</dd>
</dl>
</td>
</tr>
<tr class="row-odd"><td colspan="2"><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">max_concurrency()</span></code></dt><dd><p>Returns the concurrency level of the task arena currently used by the calling
thread. If the thread has not yet initialized the task scheduler, returns
the concurrency level determined automatically for the hardware configuration.</p>
</dd>
</dl>
</td>
</tr>
<tr class="row-even"><td colspan="2"><dl>
<dt><code class="docutils literal notranslate"><span class="pre">isolate</span></code></dt><dd><p><em>Until C++11:</em></p>
<p><code class="docutils literal notranslate"><span class="pre">template&lt;F&gt;</span> <span class="pre">void</span> <span class="pre">isolate(F&amp;)</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">template&lt;F&gt;</span> <span class="pre">void</span> <span class="pre">isolate(const</span> <span class="pre">F&amp;)</span></code></p>
<p><em>Since C++11:</em></p>
<p><code class="docutils literal notranslate"><span class="pre">template&lt;F&gt;</span> <span class="pre">auto</span> <span class="pre">isolate(F&amp;)</span> <span class="pre">-&gt;</span> <span class="pre">decltype(f())</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">template&lt;F&gt;</span> <span class="pre">auto</span> <span class="pre">isolate(const</span> <span class="pre">F&amp;)</span> <span class="pre">-&gt;</span> <span class="pre">decltype(f())</span></code></p>
<p>Runs the specified functor in isolation by restricting the calling thread to
process only tasks scheduled in the scope of the functor (also called the
isolation region). Since C++11 the function returns the value returned by
the functor.</p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>The object returned by the functor cannot be a reference.
<code class="docutils literal notranslate"><span class="pre">std::reference_wrapper</span></code> can be used instead.</p>
</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Asynchronous parallel constructs such as a flow graph or a
<code class="docutils literal notranslate"><span class="pre">task_group</span></code> should be used with care within an isolated region.
For <code class="docutils literal notranslate"><span class="pre">graph::wait_for_all</span></code> or <code class="docutils literal notranslate"><span class="pre">task_group::wait</span></code>
executed in isolation, tasks scheduled by calling <code class="docutils literal notranslate"><span class="pre">try_put</span></code> for a
flow graph node or by <code class="docutils literal notranslate"><span class="pre">task_group::run</span></code> are only accessible if
scheduled in the same isolation region or in a task previously spawned in that
region. Otherwise, performance issues and even deadlocks are possible.</p>
</div>
</dd>
</dl>
</td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
</tr>
</tbody>
</table>
<p>See also:</p>
<ul class="simple">
<li><p><a class="reference internal" href="task_groups.html"><span class="doc">Task Groups</span></a></p></li>
<li><p><a class="reference internal" href="task_scheduler_observer.html"><span class="doc">task_scheduler_observer Class</span></a></p></li>
<li><p><a class="reference internal" href="../exceptions.html"><span class="doc">Exceptions</span></a></p></li>
<li><p><a class="reference internal" href="fpu_settings.html"><span class="doc">Floating-point Settings</span></a></p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="task_scheduler_observer.html" class="btn btn-neutral float-right" title="task_scheduler_observer" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="task_group_context.html" class="btn btn-neutral float-left" title="task_group_context" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Intel Corporation

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>