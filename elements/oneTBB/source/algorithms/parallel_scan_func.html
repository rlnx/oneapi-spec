

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>parallel_scan Template Function &mdash; oneAPI Specification 0.7 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../../_static/favicons.png"/>
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/language_data.js"></script>
        <script src="../../../../_static/custom.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="pre_scan_tag and final_scan_tag Classes" href="parallel_scan_func/pre_scan_tag_and_final_scan_tag_clses.html" />
    <link rel="prev" title="parallel_deterministic_reduce Template Function" href="parallel_deterministic_reduce_func.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="https://oneapi.com" class="icon icon-home"> oneAPI Specification
          

          
            
            <img src="../../../../_static/oneAPI-rgb-rev-100.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.7
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../architecture.html">Software Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../library-interop.html">Library Interoperability</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../elements.html">oneAPI Elements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dpcpp/source/index.html">DPC++ 0.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneDPL/source/index.html">oneDPL 0.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneDNN/source/index.html">oneDNN 0.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneCCL/source/index.html">oneCCL 0.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../l0/source/index.html">Level Zero 0.91</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneDAL/source/index.html">oneDAL 0.7</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../nested-index.html">oneTBB 0.7</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../nested-gen-info.html">General Information</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../nested-interfaces.html">oneTBB Interfaces</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../configuration.html">Configuration</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../algorithms.html">Algorithms</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="splittable_concept.html">Splittable Concept</a></li>
<li class="toctree-l4"><a class="reference internal" href="range_concept.html">Range Concept</a></li>
<li class="toctree-l4"><a class="reference internal" href="partitioners.html">Partitioners</a></li>
<li class="toctree-l4"><a class="reference internal" href="parallel_for_func.html">parallel_for Template Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="parallel_reduce_func.html">parallel_reduce Template Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="parallel_deterministic_reduce_func.html">parallel_deterministic_reduce Template Function</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">parallel_scan Template Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="parallel_do_func.html">parallel_do Template Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="parallel_for_each_func.html">parallel_for_each Template Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="parallel_invoke_func.html">parallel_invoke Template Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="variadic_parallel_invoke_func.html">parallel_invoke Variadic Template Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="parallel_pipeline_func.html">parallel_pipeline Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="parallel_sort_func.html">parallel_sort Template Function</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../flow_graph.html">Flow Graph</a></li>
<li class="toctree-l3"><a class="reference internal" href="../task_scheduler.html">Task Scheduler</a></li>
<li class="toctree-l3"><a class="reference internal" href="../containers.html">Containers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../thread_local_storage.html">Thread Local Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exceptions.html">Exceptions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../nested-aux-interfaces.html">oneTBB Auxiliary Interfaces</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneVPL/source/index.html">oneVPL 0.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneMKL/source/index.html">oneMKL 0.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contributors.html">Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../versions.html">HTML and PDF Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notices.html">Legal Notices and Disclaimers</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">oneAPI Specification</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">oneAPI Specification</a> &raquo;</li>
        
          
          <li><a href="../nested-index.html">oneTBB 0.7</a> </li>
          
        
          
        
          
        
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/oneapi-src/oneapi-spec/blob/master/source/elements/oneTBB/source/algorithms/parallel_scan_func.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="parallel-scan-template-function">
<h1>parallel_scan Template Function<a class="headerlink" href="#parallel-scan-template-function" title="Permalink to this headline">¶</a></h1>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Template function that computes parallel prefix.</p>
</div>
<div class="section" id="header">
<h2>Header<a class="headerlink" href="#header" title="Permalink to this headline">¶</a></h2>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;tbb/parallel_scan.h&quot;</span><span class="cp"></span>
</pre></div>
</div>
</div>
<div class="section" id="syntax">
<h2>Syntax<a class="headerlink" href="#syntax" title="Permalink to this headline">¶</a></h2>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Range</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Body</span><span class="o">&gt;</span>
<span class="kt">void</span> <span class="n">parallel_scan</span><span class="p">(</span> <span class="k">const</span> <span class="n">Range</span><span class="o">&amp;</span> <span class="n">range</span><span class="p">,</span> <span class="n">Body</span><span class="o">&amp;</span> <span class="n">body</span> <span class="p">[,</span> <span class="n">partitioner</span><span class="p">]</span> <span class="p">);</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Range</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Value</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Scan</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Combine</span><span class="o">&gt;</span>
<span class="n">Value</span> <span class="n">parallel_scan</span><span class="p">(</span> <span class="k">const</span> <span class="n">Range</span><span class="o">&amp;</span> <span class="n">range</span><span class="p">,</span> <span class="k">const</span> <span class="n">Value</span><span class="o">&amp;</span> <span class="n">identity</span><span class="p">,</span>
                     <span class="k">const</span> <span class="n">Scan</span><span class="o">&amp;</span> <span class="n">scan</span><span class="p">,</span> <span class="k">const</span> <span class="n">Combine</span><span class="o">&amp;</span> <span class="n">combine</span>
                     <span class="p">[,</span> <span class="n">partitioner</span><span class="p">]</span> <span class="p">);</span>
</pre></div>
</div>
<p>where the optional <code class="docutils literal notranslate"><span class="pre">partitioner</span></code> declares <code class="docutils literal notranslate"><span class="pre">auto_partitioner</span></code>
or <code class="docutils literal notranslate"><span class="pre">simple_partitioner</span></code>
as shown in column 1 of the Partitioners table in the Partitioners section.</p>
</div>
<div class="section" id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">parallel_scan</span></code> template function
computes a parallel prefix, also known as parallel scan. This computation is an advanced concept
in parallel computing that is sometimes useful in scenarios that appear to have inherently
serial dependences.</p>
<p>A mathematical definition of the parallel prefix is as follows. Let
× be an associative operation with left-identity element id<sub>×</sub>.
The parallel prefix of × over a sequence <em>z</em><sub>0</sub>, <em>z</em><sub>1</sub>, …*z*<sub>n-1</sub>
is a sequence <em>y</em><sub>0</sub>, <em>y</em><sub>1</sub>, <em>y</em><sub>2</sub>, …*y*<sub>n-1</sub>
where:</p>
<ul class="simple">
<li><p>y<sub>0</sub> = id<sub>×</sub> × z<sub>0</sub></p></li>
<li><p>y<sub>i</sub> = y<sub>i-1</sub> × z<sub>i</sub></p></li>
</ul>
<p>For example, if × is addition, the parallel prefix corresponds a running sum. A
serial implementation of parallel prefix is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>T temp = id×;
for( int i=1; i&lt;=n; ++i ) {
    temp = temp × z[i];
    y[i] = temp;
}
</pre></div>
</div>
<p>Parallel prefix performs this in parallel by reassociating the application of × and using two
passes. It may invoke × up to twice as many times as the serial prefix algorithm. Even though
it does more work, given the right grain size the parallel algorithm can outperform the serial one
because it distributes the work across multiple hardware threads.
To obtain decent speedup, systems with more than two cores are recommended.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">parallel_scan</span></code> template function has two forms.
The imperative form <code class="docutils literal notranslate"><span class="pre">parallel_scan(range,</span> <span class="pre">body)</span></code> implements parallel prefix
generically. Type <code class="docutils literal notranslate"><span class="pre">Range</span></code> must model the Range concept. The body must
model the requirements in the following table.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 1%" />
<col style="width: 99%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="2"><p>Requirements for parallel_scan Body: Pseudo-Signature, Semantics</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="2"><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">Body::operator()(</span> <span class="pre">const</span> <span class="pre">Range&amp;</span> <span class="pre">r,</span> <span class="pre">pre_scan_tag</span> <span class="pre">)</span></code></dt><dd><p>Accumulate summary for range <code class="docutils literal notranslate"><span class="pre">r</span></code>.</p>
</dd>
</dl>
</td>
</tr>
<tr class="row-odd"><td colspan="2"><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">Body::operator()(</span> <span class="pre">const</span> <span class="pre">Range&amp;</span> <span class="pre">r,</span> <span class="pre">final_scan_tag</span> <span class="pre">)</span></code></dt><dd><p>Compute scan result and summary for range <code class="docutils literal notranslate"><span class="pre">r</span></code>.</p>
</dd>
</dl>
</td>
</tr>
<tr class="row-even"><td colspan="2"><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">Body::Body(</span> <span class="pre">Body&amp;</span> <span class="pre">b,</span> <span class="pre">split</span> <span class="pre">)</span></code></dt><dd><p>Split <code class="docutils literal notranslate"><span class="pre">b</span></code> so that <code class="docutils literal notranslate"><span class="pre">this</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> can
accumulate summaries separately.</p>
</dd>
</dl>
</td>
</tr>
<tr class="row-odd"><td colspan="2"><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">Body::reverse_join(</span> <span class="pre">Body&amp;</span> <span class="pre">b</span> <span class="pre">)</span></code></dt><dd><p>Merge summary accumulated by <code class="docutils literal notranslate"><span class="pre">b</span></code> into summary accumulated by
<code class="docutils literal notranslate"><span class="pre">this</span></code>, where <code class="docutils literal notranslate"><span class="pre">this</span></code> was created earlier from <code class="docutils literal notranslate"><span class="pre">b</span></code>
by splitting constructor.</p>
</dd>
</dl>
</td>
</tr>
<tr class="row-even"><td colspan="2"><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">Body::assign(</span> <span class="pre">Body&amp;</span> <span class="pre">b</span> <span class="pre">)</span></code></dt><dd><p>Assign summary of <code class="docutils literal notranslate"><span class="pre">b</span></code> to <code class="docutils literal notranslate"><span class="pre">this</span></code>.</p>
</dd>
</dl>
</td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
</tr>
</tbody>
</table>
<p>A summary contains enough information such that for two consecutive subranges <em>r</em>
and <em>s</em>:</p>
<ul class="simple">
<li><p>If <em>r</em> has no preceding subrange, the scan result for <em>s</em> can be computed from
knowing <em>s</em> and the summary for <em>r</em>.</p></li>
<li><p>A summary of <em>r</em> concatenated with <em>s</em> can be computed from the summaries of <em>r</em>
and <em>s</em>.</p></li>
</ul>
<p>For example, if computing a running sum of an array, the summary for a range <em>r</em> is
the sum of the array elements corresponding to <em>r</em>.</p>
<p>The functional form <code class="docutils literal notranslate"><span class="pre">parallel_scan(range,</span> <span class="pre">identity,</span> <span class="pre">scan,</span> <span class="pre">combine)</span></code> is designed
to use with functors and lambda expressions, hiding some complexities of the imperative form.
It uses the same <em>scan</em> functor in both passes, differentiating them via a Boolean parameter,
combines summaries with <em>combine</em> functor, and returns the summary computed over the whole
<em>range</em>.
The table below summarizes the type requirements on the types of <em>identity</em>, <em>scan</em>,
and <em>combine</em>.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 1%" />
<col style="width: 99%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="2"><p>Requirements for Scan and Combine: Pseudo-Signature, Semantics</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="2"><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">Value</span> <span class="pre">identity</span></code></dt><dd><p>Left identity element for <code class="docutils literal notranslate"><span class="pre">Scan::operator()</span></code>.</p>
</dd>
</dl>
</td>
</tr>
<tr class="row-odd"><td colspan="2"><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">Value</span> <span class="pre">Scan::operator()(const</span> <span class="pre">Range&amp;</span> <span class="pre">r,</span> <span class="pre">const</span> <span class="pre">Value&amp;</span> <span class="pre">sum,</span> <span class="pre">bool</span> <span class="pre">is_final)</span> <span class="pre">const</span></code></dt><dd><p>Starting with <code class="docutils literal notranslate"><span class="pre">sum</span></code>, compute the summary
and, for <code class="docutils literal notranslate"><span class="pre">is_final</span> <span class="pre">==</span> <span class="pre">true</span></code>, the scan result
for range <code class="docutils literal notranslate"><span class="pre">r</span></code>. Return the computed summary.</p>
</dd>
</dl>
</td>
</tr>
<tr class="row-even"><td colspan="2"><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">Value</span> <span class="pre">Combine::operator()(const</span> <span class="pre">Value&amp;</span> <span class="pre">left,</span> <span class="pre">const</span> <span class="pre">Value&amp;</span> <span class="pre">right)</span> <span class="pre">const</span></code></dt><dd><p>Combine summaries <code class="docutils literal notranslate"><span class="pre">left</span></code> and <code class="docutils literal notranslate"><span class="pre">right</span></code>,
and return the result.</p>
</dd>
</dl>
</td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
</tr>
</tbody>
</table>
<p>The figure below shows one way that <code class="docutils literal notranslate"><span class="pre">parallel_scan</span></code> might compute the running
sum of an array containing the integers 1-16. Time flows downwards in the diagram. Each
color denotes a separate <code class="docutils literal notranslate"><span class="pre">Body</span></code> object. Summaries are shown in brackets.</p>
<ul class="simple">
<li><p>The first two steps split the original blue body into the pink and yellow bodies. Each body
operates on a quarter of the input array in parallel. The last quarter is processed later in step 5.</p></li>
<li><p>The blue body computes the final scan and summary for 1-4. The pink and yellow bodies compute
their summaries by prescanning 5-8 and 9-12 respectively.</p></li>
<li><p>The pink body computes its summary for 1-8 by performing a reverse_join with the blue body.</p></li>
<li><p>The yellow body computes its summary for 1-12 by performing a reverse_join with the pink body.</p></li>
<li><p>The blue, pink, and yellow bodies compute final scans and summaries for portions of the array.</p></li>
<li><p>The yellow summary is assigned to the blue body. The pink and yellow bodies are destroyed.</p></li>
</ul>
<p>Note that two quarters of the array were not prescanned. The <code class="docutils literal notranslate"><span class="pre">parallel_scan</span></code> template
makes an effort to avoid prescanning where possible, to improve performance when there are only a few
or no extra worker threads. If no other workers are available, <code class="docutils literal notranslate"><span class="pre">parallel_scan</span></code> processes
the subranges without any pre_scans, by processing the subranges from left to right using final scans.
That’s why final scans must compute a summary as well as the final scan result. The summary might be
needed to process the next subrange if no worker thread has prescanned it yet.</p>
<p><strong>Example Execution of parallel_scan</strong></p>
<img alt="../../../../_images/parll_scan.jpg" src="../../../../_images/parll_scan.jpg" />
</div>
<div class="section" id="example-imperative-form">
<h2>Example (Imperative Form)<a class="headerlink" href="#example-imperative-form" title="Permalink to this headline">¶</a></h2>
<p>The following code demonstrates how Body could be implemented for <code class="docutils literal notranslate"><span class="pre">parallel_scan</span></code>
to compute the same result as the earlier sequential example involving ×:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>class Body {
    T sum;
    T* const y;
    const T* const z;
public:
    Body( T y_[], const T z_[] ) : sum(id×), z(z_), y(y_) {}
    T get_sum() const { return sum; }

    template&lt;typename Tag&gt;
    void operator()( const tbb::blocked_range&lt;int&gt;&amp; r, Tag ) {
        T temp = sum;
        for( int i=r.begin(); i&lt;r.end(); ++i ) {
            temp = temp × z[i];
            if( Tag::is_final_scan() )
                y[i] = temp;
        }
        sum = temp;
    }
    Body( Body&amp; b, tbb::split ) : z(b.z), y(b.y), sum(id×) {}
    void reverse_join( Body&amp; a ) { sum = a.sum × sum; }
    void assign( Body&amp; b ) { sum = b.sum; }
};

T DoParallelScan( T y[], const T z[], int n ) {
    Body body(y,z);
    tbb::parallel_scan( tbb::blocked_range&lt;int&gt;(0,n), body );
    return body.get_sum();
}
</pre></div>
</div>
<p>The definition of <code class="docutils literal notranslate"><span class="pre">operator()</span></code> demonstrates typical patterns when using
<code class="docutils literal notranslate"><span class="pre">parallel_scan</span></code>.</p>
<ul class="simple">
<li><p>A single template defines both versions. Doing so is not required, but usually saves coding
effort, because the two versions are usually similar. The library defines static method
<code class="docutils literal notranslate"><span class="pre">is_final_scan(</span></code>) to enable differentiation between the versions.</p></li>
<li><p>The prescan variant computes the × reduction, but does not update <code class="docutils literal notranslate"><span class="pre">y</span></code>.
The prescan is used by <code class="docutils literal notranslate"><span class="pre">parallel_scan</span></code> to generate look-ahead partial reductions.</p></li>
<li><p>The final scan variant computes the × reduction and updates <code class="docutils literal notranslate"><span class="pre">y</span></code>.</p></li>
</ul>
<p>The operation <code class="docutils literal notranslate"><span class="pre">reverse_join</span></code> is similar to the operation <code class="docutils literal notranslate"><span class="pre">join</span></code>
used by <code class="docutils literal notranslate"><span class="pre">parallel_reduce</span></code>, except that the arguments are reversed.
That is, <code class="docutils literal notranslate"><span class="pre">this</span></code> is the <em>right</em> argument of ×. Template function
<code class="docutils literal notranslate"><span class="pre">parallel_scan</span></code> decides if and when to generate parallel work.
It is thus crucial that × is associative and that the methods of Body faithfully represent it.
Operations such as floating-point addition that are somewhat associative can be used, with the
understanding that the results may be rounded differently depending upon the association used by
<code class="docutils literal notranslate"><span class="pre">parallel_scan</span></code>. The reassociation may differ between runs even on the same
machine. However, if there are no worker threads available, execution associates identically to
the serial form shown at the beginning of this section.</p>
<p>If you change the example to use a <code class="docutils literal notranslate"><span class="pre">simple_partitioner</span></code>, be sure to provide a grain size.
The code below shows the how to do this for the grain size of 1000:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">parallel_scan</span><span class="p">(</span><span class="n">blocked_range</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="mi">1000</span><span class="p">),</span> <span class="n">total</span><span class="p">,</span> <span class="n">simple_partitioner</span><span class="p">()</span> <span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="example-with-lambda-expressions">
<h2>Example with Lambda Expressions<a class="headerlink" href="#example-with-lambda-expressions" title="Permalink to this headline">¶</a></h2>
<p>The following is analogous to the previous example, but written using lambda expressions and the functional form of parallel_scan:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>T DoParallelScan( T y[], const T z[], int n ) {
    return tbb::parallel_scan(
        tbb::blocked_range&lt;int&gt;(0,n),
        id×,
        [](const tbb::blocked_range&lt;int&gt;&amp; r, T sum, bool is_final_scan)-&gt;T {
            T temp = sum;
            for( int i=r.begin(); i&lt;r.end(); ++i ) {
                temp = temp × z[i];
                if( is_final_scan )
                    y[i] = temp;
            }
            return temp;
        },
        []( T left, T right ) {
            return left × right;
        }
    );
}
</pre></div>
</div>
<p>See also:</p>
<ul class="simple">
<li><p><a class="reference internal" href="parallel_scan_func/pre_scan_tag_and_final_scan_tag_clses.html"><span class="doc">pre_scan_tag and final_scan_tag Classes</span></a></p></li>
</ul>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="parallel_scan_func/pre_scan_tag_and_final_scan_tag_clses.html">pre_scan_tag and final_scan_tag Classes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="parallel_scan_func/pre_scan_tag_and_final_scan_tag_clses.html#summary">Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="parallel_scan_func/pre_scan_tag_and_final_scan_tag_clses.html#header">Header</a></li>
<li class="toctree-l2"><a class="reference internal" href="parallel_scan_func/pre_scan_tag_and_final_scan_tag_clses.html#syntax">Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="parallel_scan_func/pre_scan_tag_and_final_scan_tag_clses.html#description">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="parallel_scan_func/pre_scan_tag_and_final_scan_tag_clses.html#members">Members</a></li>
</ul>
</li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="parallel_scan_func/pre_scan_tag_and_final_scan_tag_clses.html" class="btn btn-neutral float-right" title="pre_scan_tag and final_scan_tag Classes" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="parallel_deterministic_reduce_func.html" class="btn btn-neutral float-left" title="parallel_deterministic_reduce Template Function" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Intel Corporation

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>