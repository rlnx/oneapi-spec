

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>parallel_for Template Function &mdash; oneAPI Specification 0.7 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../../_static/favicons.png"/>
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/language_data.js"></script>
        <script src="../../../../_static/custom.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="parallel_reduce Template Function" href="parallel_reduce_func.html" />
    <link rel="prev" title="simple_partitioner Class" href="partitioners/simple_partitioner_cls.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="https://oneapi.com" class="icon icon-home"> oneAPI Specification
          

          
            
            <img src="../../../../_static/oneAPI-rgb-rev-100.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.7
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../architecture.html">Software Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../library-interop.html">Library Interoperability</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../elements.html">oneAPI Elements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dpcpp/source/index.html">DPC++ 0.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneDPL/source/index.html">oneDPL 0.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneDNN/source/index.html">oneDNN 0.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneCCL/source/index.html">oneCCL 0.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../l0/source/index.html">Level Zero 0.91</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneDAL/source/index.html">oneDAL 0.7</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../nested-index.html">oneTBB 0.7</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../nested-gen-info.html">General Information</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../nested-interfaces.html">oneTBB Interfaces</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../configuration.html">Configuration</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../algorithms.html">Algorithms</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="splittable_concept.html">Splittable Concept</a></li>
<li class="toctree-l4"><a class="reference internal" href="range_concept.html">Range Concept</a></li>
<li class="toctree-l4"><a class="reference internal" href="partitioners.html">Partitioners</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">parallel_for Template Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="parallel_reduce_func.html">parallel_reduce Template Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="parallel_deterministic_reduce_func.html">parallel_deterministic_reduce Template Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="parallel_scan_func.html">parallel_scan Template Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="parallel_do_func.html">parallel_do Template Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="parallel_for_each_func.html">parallel_for_each Template Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="parallel_invoke_func.html">parallel_invoke Template Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="variadic_parallel_invoke_func.html">parallel_invoke Variadic Template Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="parallel_pipeline_func.html">parallel_pipeline Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="parallel_sort_func.html">parallel_sort Template Function</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../flow_graph.html">Flow Graph</a></li>
<li class="toctree-l3"><a class="reference internal" href="../task_scheduler.html">Task Scheduler</a></li>
<li class="toctree-l3"><a class="reference internal" href="../containers.html">Containers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../thread_local_storage.html">Thread Local Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exceptions.html">Exceptions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../nested-aux-interfaces.html">oneTBB Auxiliary Interfaces</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneVPL/source/index.html">oneVPL 0.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneMKL/source/index.html">oneMKL 0.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contributors.html">Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../versions.html">HTML and PDF Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notices.html">Legal Notices and Disclaimers</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">oneAPI Specification</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">oneAPI Specification</a> &raquo;</li>
        
          
          <li><a href="../nested-index.html">oneTBB 0.7</a> </li>
          
        
          
        
          
        
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/oneapi-src/oneapi-spec/blob/master/source/elements/oneTBB/source/algorithms/parallel_for_func.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="parallel-for-template-function">
<h1>parallel_for Template Function<a class="headerlink" href="#parallel-for-template-function" title="Permalink to this headline">¶</a></h1>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Template function that performs parallel iteration over a range of values.</p>
</div>
<div class="section" id="header">
<h2>Header<a class="headerlink" href="#header" title="Permalink to this headline">¶</a></h2>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;tbb/parallel_for.h&quot;</span><span class="cp"></span>
</pre></div>
</div>
</div>
<div class="section" id="syntax">
<h2>Syntax<a class="headerlink" href="#syntax" title="Permalink to this headline">¶</a></h2>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Index</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Func</span><span class="o">&gt;</span>
<span class="n">Func</span> <span class="n">parallel_for</span><span class="p">(</span> <span class="n">Index</span> <span class="n">first</span><span class="p">,</span> <span class="n">Index_type</span> <span class="n">last</span><span class="p">,</span> <span class="k">const</span> <span class="n">Func</span><span class="o">&amp;</span> <span class="n">f</span>
                   <span class="p">[,</span> <span class="n">partitioner</span><span class="p">[,</span> <span class="n">task_group_context</span><span class="o">&amp;</span> <span class="n">group</span><span class="p">]]</span> <span class="p">);</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Index</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Func</span><span class="o">&gt;</span>
<span class="n">Func</span> <span class="n">parallel_for</span><span class="p">(</span> <span class="n">Index</span> <span class="n">first</span><span class="p">,</span> <span class="n">Index_type</span> <span class="n">last</span><span class="p">,</span>
                   <span class="n">Index</span> <span class="n">step</span><span class="p">,</span> <span class="k">const</span> <span class="n">Func</span><span class="o">&amp;</span> <span class="n">f</span>
                   <span class="p">[,</span> <span class="n">partitioner</span><span class="p">[,</span> <span class="n">task_group_context</span><span class="o">&amp;</span> <span class="n">group</span><span class="p">]]</span> <span class="p">);</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Range</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Body</span><span class="o">&gt;</span>
<span class="kt">void</span> <span class="n">parallel_for</span><span class="p">(</span> <span class="k">const</span> <span class="n">Range</span><span class="o">&amp;</span> <span class="n">range</span><span class="p">,</span> <span class="k">const</span> <span class="n">Body</span><span class="o">&amp;</span> <span class="n">body</span><span class="p">,</span>
                   <span class="p">[,</span> <span class="n">partitioner</span><span class="p">[,</span> <span class="n">task_group_context</span><span class="o">&amp;</span> <span class="n">group</span><span class="p">]]</span> <span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>A <code class="docutils literal notranslate"><span class="pre">parallel_for(first,last,step,f)</span></code> represents parallel execution of the
loop:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">for</span><span class="p">(</span> <span class="k">auto</span> <span class="n">i</span><span class="o">=</span><span class="n">first</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">last</span><span class="p">;</span> <span class="n">i</span><span class="o">+=</span><span class="n">step</span> <span class="p">)</span> <span class="n">f</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
</pre></div>
</div>
<p>The index type must be an integral type. The loop must not wrap around. The step value must be
positive. If omitted, it is implicitly 1. There is no guarantee that the iterations
run in parallel. Deadlock may occur if a lesser iteration waits for a greater
iteration. The partitioning strategy is
<code class="docutils literal notranslate"><span class="pre">auto_partitioner</span></code> when the parameter is not specified.</p>
<p>A <code class="docutils literal notranslate"><span class="pre">parallel_for(range,body,partitioner)</span></code> provides a more general form of parallel
iteration. It represents parallel execution of <code class="docutils literal notranslate"><span class="pre">body</span></code> over each value
in range. The optional <code class="docutils literal notranslate"><span class="pre">partitioner</span></code> specifies a partitioning
strategy. Type <code class="docutils literal notranslate"><span class="pre">Range</span></code> must model the Range concept . The body must
model the requirements in the following table.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 1%" />
<col style="width: 99%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="2"><p>Requirements for parallel_for Body: Pseudo-Signature, Semantics</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="2"><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">Body::Body(</span> <span class="pre">const</span> <span class="pre">Body&amp;</span> <span class="pre">)</span></code></dt><dd><p>Copy constructor.</p>
</dd>
</dl>
</td>
</tr>
<tr class="row-odd"><td colspan="2"><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">Body::~Body()</span></code></dt><dd><p>Destructor.</p>
</dd>
</dl>
</td>
</tr>
<tr class="row-even"><td colspan="2"><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">Body::operator()(</span> <span class="pre">Range&amp;</span> <span class="pre">range</span> <span class="pre">)</span> <span class="pre">const</span></code></dt><dd><p>Apply body to range.</p>
</dd>
</dl>
</td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
</tr>
</tbody>
</table>
<p>A <code class="docutils literal notranslate"><span class="pre">parallel_for</span></code> recursively splits the range into subranges to the
point such that <code class="docutils literal notranslate"><span class="pre">is_divisible()</span></code> is false for each subrange, and
makes copies of the body for each of these subranges. For each such body/subrange
pair, it invokes <code class="docutils literal notranslate"><span class="pre">Body::operator()</span></code>. The invocations are
interleaved with the recursive splitting, in order to minimize space overhead and
efficiently use cache.</p>
<p>Some of the copies of the range and body may be destroyed after
<code class="docutils literal notranslate"><span class="pre">parallel_for</span></code> returns. This late destruction is not an issue in
typical usage, but is something to be aware of when looking at execution traces or
writing range or body objects with complex side effects.</p>
<p>When worker threads are available, <code class="docutils literal notranslate"><span class="pre">parallel_for</span></code> executes
iterations in non-deterministic order. Do not rely upon any particular execution
order for correctness. However, for efficiency, do expect
<code class="docutils literal notranslate"><span class="pre">parallel_for</span></code> to tend towards operating on consecutive runs of
values.</p>
<p>When no worker threads are available, <code class="docutils literal notranslate"><span class="pre">parallel_for</span></code> executes
iterations from left to right in the following sense. Imagine drawing a binary
tree that represents the recursive splitting. Each non-leaf node represents
splitting a subrange <code class="docutils literal notranslate"><span class="pre">r</span></code> by invoking one of the splitting
constructors of <code class="docutils literal notranslate"><span class="pre">Range</span></code>. The left child represents the updated value of
<code class="docutils literal notranslate"><span class="pre">r</span></code>. The right child represents the newly constructed object. Each
leaf in the tree represents an indivisible subrange.  The method
<code class="docutils literal notranslate"><span class="pre">Body::operator()</span></code> is invoked on each leaf subrange, from left to
right.</p>
<p>All overloads can be passed a <code class="docutils literal notranslate"><span class="pre">task_group_context</span></code> object so that
the algorithm’s tasks are executed in this group. By default the algorithm is
executed in a bound group of its own.</p>
<p><strong>Complexity</strong></p>
<p>If the range and body take O(1) space, and the range splits into nearly equal
pieces, then the space complexity is O(P log(N)), where N is the size of the range
and P is the number of threads.</p>
</div>
<div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<p>This example defines a routine <code class="docutils literal notranslate"><span class="pre">ParallelAverage</span></code> that sets
<code class="docutils literal notranslate"><span class="pre">output[i]</span></code> to the average of <code class="docutils literal notranslate"><span class="pre">input[i-1]</span></code>,
<code class="docutils literal notranslate"><span class="pre">input[i]</span></code>, and <code class="docutils literal notranslate"><span class="pre">input[i+1]</span></code>, for 1 &lt;= i&lt; n.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;tbb/parallel_for.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;tbb/blocked_range.h&quot;</span><span class="cp"></span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">tbb</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">Average</span> <span class="p">{</span>
    <span class="k">const</span> <span class="kt">float</span><span class="o">*</span> <span class="n">input</span><span class="p">;</span>
    <span class="kt">float</span><span class="o">*</span> <span class="n">output</span><span class="p">;</span>
    <span class="kt">void</span> <span class="nf">operator</span><span class="p">()(</span> <span class="k">const</span> <span class="n">blocked_range</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&amp;</span> <span class="n">range</span> <span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
        <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">range</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">i</span><span class="o">!=</span><span class="n">range</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
            <span class="n">output</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">input</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">input</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">input</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mf">3.f</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// Note: Reads input[0..n] and writes output[1..n-1].</span>
<span class="kt">void</span> <span class="nf">ParallelAverage</span><span class="p">(</span> <span class="kt">float</span><span class="o">*</span> <span class="n">output</span><span class="p">,</span> <span class="k">const</span> <span class="kt">float</span><span class="o">*</span> <span class="n">input</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">n</span> <span class="p">)</span> <span class="p">{</span>
    <span class="n">Average</span> <span class="n">avg</span><span class="p">;</span>
    <span class="n">avg</span><span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="n">input</span><span class="p">;</span>
    <span class="n">avg</span><span class="p">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">output</span><span class="p">;</span>
    <span class="n">parallel_for</span><span class="p">(</span> <span class="n">blocked_range</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="p">),</span> <span class="n">avg</span> <span class="p">);</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h2>Example<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>This example is more complex and requires familiarity with STL. It shows the power of
<code class="docutils literal notranslate"><span class="pre">parallel_for</span></code> beyond flat iteration spaces. The code performs a parallel
merge of two sorted sequences. It works for any sequence with a random-access
iterator. The algorithm (Akl 1987) works recursively as follows:</p>
<ul class="simple">
<li><p>If the sequences are too short for effective use of parallelism, do a sequential merge. Otherwise perform steps 2-6.</p></li>
<li><p>Swap the sequences if necessary, so that the first sequence [begin1,end1) is at least as long as the second sequence [begin2,end2).</p></li>
<li><p>Set m1 to the middle position in [begin1,end1). Call the item at that location key.</p></li>
<li><p>Set m2 to where <em>key</em> would fall in [begin2,end2).</p></li>
<li><p>Merge [begin1,m1) and [begin2,m2) to create the first part of the merged sequence.</p></li>
<li><p>Merge [m1,end1) and [m2,end2) to create the second part of the merged sequence.</p></li>
</ul>
<p>The oneAPI Threading Building Blocks implementation of this algorithm uses the range object to
perform most of the steps. Predicate <code class="docutils literal notranslate"><span class="pre">is_divisible</span></code> performs the test
in step 1, and step 2. The splitting constructor does steps 3-6. The body object
does the sequential merges.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;tbb/parallel_for.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp"></span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">tbb</span><span class="p">;</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Iterator</span><span class="o">&gt;</span>
<span class="k">struct</span> <span class="n">ParallelMergeRange</span> <span class="p">{</span>
    <span class="k">static</span> <span class="kt">size_t</span> <span class="n">grainsize</span><span class="p">;</span>
    <span class="n">Iterator</span> <span class="n">begin1</span><span class="p">,</span> <span class="n">end1</span><span class="p">;</span> <span class="c1">// [begin1,end1) is 1st sequence to be merged</span>
    <span class="n">Iterator</span> <span class="n">begin2</span><span class="p">,</span> <span class="n">end2</span><span class="p">;</span> <span class="c1">// [begin2,end2) is 2nd sequence to be merged</span>
    <span class="n">Iterator</span> <span class="n">out</span><span class="p">;</span>               <span class="c1">// where to put merged sequence</span>
    <span class="kt">bool</span> <span class="nf">empty</span><span class="p">()</span>   <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="p">(</span><span class="n">end1</span><span class="o">-</span><span class="n">begin1</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">end2</span><span class="o">-</span><span class="n">begin2</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">;}</span>
    <span class="kt">bool</span> <span class="nf">is_divisible</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="p">(</span> <span class="n">end1</span><span class="o">-</span><span class="n">begin1</span><span class="p">,</span> <span class="n">end2</span><span class="o">-</span><span class="n">begin2</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="n">grainsize</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">ParallelMergeRange</span><span class="p">(</span> <span class="n">ParallelMergeRange</span><span class="o">&amp;</span> <span class="n">r</span><span class="p">,</span> <span class="n">split</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">r</span><span class="p">.</span><span class="n">end1</span><span class="o">-</span><span class="n">r</span><span class="p">.</span><span class="n">begin1</span> <span class="o">&lt;</span> <span class="n">r</span><span class="p">.</span><span class="n">end2</span><span class="o">-</span><span class="n">r</span><span class="p">.</span><span class="n">begin2</span> <span class="p">)</span> <span class="p">{</span>
            <span class="n">std</span><span class="o">::</span><span class="n">swap</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">begin1</span><span class="p">,</span><span class="n">r</span><span class="p">.</span><span class="n">begin2</span><span class="p">);</span>
            <span class="n">std</span><span class="o">::</span><span class="n">swap</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">end1</span><span class="p">,</span><span class="n">r</span><span class="p">.</span><span class="n">end2</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">Iterator</span> <span class="n">m1</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="n">begin1</span> <span class="o">+</span> <span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">end1</span><span class="o">-</span><span class="n">r</span><span class="p">.</span><span class="n">begin1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
        <span class="n">Iterator</span> <span class="n">m2</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">lower_bound</span><span class="p">(</span> <span class="n">r</span><span class="p">.</span><span class="n">begin2</span><span class="p">,</span> <span class="n">r</span><span class="p">.</span><span class="n">end2</span><span class="p">,</span> <span class="o">*</span><span class="n">m1</span> <span class="p">);</span>
        <span class="n">begin1</span> <span class="o">=</span> <span class="n">m1</span><span class="p">;</span>
        <span class="n">begin2</span> <span class="o">=</span> <span class="n">m2</span><span class="p">;</span>
        <span class="n">end1</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="n">end1</span><span class="p">;</span>
        <span class="n">end2</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="n">end2</span><span class="p">;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="n">out</span> <span class="o">+</span> <span class="p">(</span><span class="n">m1</span><span class="o">-</span><span class="n">r</span><span class="p">.</span><span class="n">begin1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">m2</span><span class="o">-</span><span class="n">r</span><span class="p">.</span><span class="n">begin2</span><span class="p">);</span>
        <span class="n">r</span><span class="p">.</span><span class="n">end1</span> <span class="o">=</span> <span class="n">m1</span><span class="p">;</span>
        <span class="n">r</span><span class="p">.</span><span class="n">end2</span> <span class="o">=</span> <span class="n">m2</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">ParallelMergeRange</span><span class="p">(</span> <span class="n">Iterator</span> <span class="n">begin1_</span><span class="p">,</span> <span class="n">Iterator</span> <span class="n">end1_</span><span class="p">,</span>
                        <span class="n">Iterator</span> <span class="n">begin2_</span><span class="p">,</span> <span class="n">Iterator</span> <span class="n">end2_</span><span class="p">,</span>
                        <span class="n">Iterator</span> <span class="n">out_</span> <span class="p">)</span> <span class="o">:</span>
        <span class="n">begin1</span><span class="p">(</span><span class="n">begin1_</span><span class="p">),</span> <span class="n">end1</span><span class="p">(</span><span class="n">end1_</span><span class="p">),</span>
        <span class="n">begin2</span><span class="p">(</span><span class="n">begin2_</span><span class="p">),</span> <span class="n">end2</span><span class="p">(</span><span class="n">end2_</span><span class="p">),</span> <span class="n">out</span><span class="p">(</span><span class="n">out_</span><span class="p">)</span>
    <span class="p">{}</span>
<span class="p">};</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Iterator</span><span class="o">&gt;</span>
<span class="kt">size_t</span> <span class="n">ParallelMergeRange</span><span class="o">&lt;</span><span class="n">Iterator</span><span class="o">&gt;::</span><span class="n">grainsize</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Iterator</span><span class="o">&gt;</span>
<span class="k">struct</span> <span class="n">ParallelMergeBody</span> <span class="p">{</span>
    <span class="kt">void</span> <span class="k">operator</span><span class="p">()(</span> <span class="n">ParallelMergeRange</span><span class="o">&lt;</span><span class="n">Iterator</span><span class="o">&gt;&amp;</span> <span class="n">r</span> <span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">merge</span><span class="p">(</span> <span class="n">r</span><span class="p">.</span><span class="n">begin1</span><span class="p">,</span> <span class="n">r</span><span class="p">.</span><span class="n">end1</span><span class="p">,</span> <span class="n">r</span><span class="p">.</span><span class="n">begin2</span><span class="p">,</span> <span class="n">r</span><span class="p">.</span><span class="n">end2</span><span class="p">,</span> <span class="n">r</span><span class="p">.</span><span class="n">out</span> <span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Iterator</span><span class="o">&gt;</span>
<span class="kt">void</span> <span class="n">ParallelMerge</span><span class="p">(</span> <span class="n">Iterator</span> <span class="n">begin1</span><span class="p">,</span> <span class="n">Iterator</span> <span class="n">end1</span><span class="p">,</span> <span class="n">Iterator</span> <span class="n">begin2</span><span class="p">,</span> <span class="n">Iterator</span> <span class="n">end2</span><span class="p">,</span> <span class="n">Iterator</span> <span class="n">out</span> <span class="p">)</span> <span class="p">{</span>
    <span class="n">parallel_for</span><span class="p">(</span>
       <span class="n">ParallelMergeRange</span><span class="o">&lt;</span><span class="n">Iterator</span><span class="o">&gt;</span><span class="p">(</span><span class="n">begin1</span><span class="p">,</span><span class="n">end1</span><span class="p">,</span><span class="n">begin2</span><span class="p">,</span><span class="n">end2</span><span class="p">,</span><span class="n">out</span><span class="p">),</span>
       <span class="n">ParallelMergeBody</span><span class="o">&lt;</span><span class="n">Iterator</span><span class="o">&gt;</span><span class="p">(),</span>
       <span class="n">simple_partitioner</span><span class="p">()</span>
    <span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Because the algorithm moves many locations, it tends to be bandwidth limited. Speedup varies, depending upon the system.</p>
<p>See also:</p>
<ul class="simple">
<li><p><a class="reference internal" href="range_concept.html"><span class="doc">Range Concept</span></a></p></li>
<li><p><a class="reference internal" href="../task_scheduler/task_group_context.html"><span class="doc">Bound groups (task_group_context Class)</span></a></p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="parallel_reduce_func.html" class="btn btn-neutral float-right" title="parallel_reduce Template Function" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="partitioners/simple_partitioner_cls.html" class="btn btn-neutral float-left" title="simple_partitioner Class" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Intel Corporation

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>