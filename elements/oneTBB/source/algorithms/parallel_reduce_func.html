

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>parallel_reduce Template Function &mdash; oneAPI Specification 0.7 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../../_static/favicons.png"/>
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/language_data.js"></script>
        <script src="../../../../_static/custom.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="parallel_deterministic_reduce Template Function" href="parallel_deterministic_reduce_func.html" />
    <link rel="prev" title="parallel_for Template Function" href="parallel_for_func.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="https://oneapi.com" class="icon icon-home"> oneAPI Specification
          

          
            
            <img src="../../../../_static/oneAPI-rgb-rev-100.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.7
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../architecture.html">Software Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../library-interop.html">Library Interoperability</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../elements.html">oneAPI Elements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dpcpp/source/index.html">DPC++ 0.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneDPL/source/index.html">oneDPL 0.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneDNN/source/index.html">oneDNN 0.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneCCL/source/index.html">oneCCL 0.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../l0/source/index.html">Level Zero 0.91</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneDAL/source/index.html">oneDAL 0.7</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../nested-index.html">oneTBB 0.7</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../nested-gen-info.html">General Information</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../nested-interfaces.html">oneTBB Interfaces</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../configuration.html">Configuration</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../algorithms.html">Algorithms</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="splittable_concept.html">Splittable Concept</a></li>
<li class="toctree-l4"><a class="reference internal" href="range_concept.html">Range Concept</a></li>
<li class="toctree-l4"><a class="reference internal" href="partitioners.html">Partitioners</a></li>
<li class="toctree-l4"><a class="reference internal" href="parallel_for_func.html">parallel_for Template Function</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">parallel_reduce Template Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="parallel_deterministic_reduce_func.html">parallel_deterministic_reduce Template Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="parallel_scan_func.html">parallel_scan Template Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="parallel_do_func.html">parallel_do Template Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="parallel_for_each_func.html">parallel_for_each Template Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="parallel_invoke_func.html">parallel_invoke Template Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="variadic_parallel_invoke_func.html">parallel_invoke Variadic Template Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="parallel_pipeline_func.html">parallel_pipeline Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="parallel_sort_func.html">parallel_sort Template Function</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../flow_graph.html">Flow Graph</a></li>
<li class="toctree-l3"><a class="reference internal" href="../task_scheduler.html">Task Scheduler</a></li>
<li class="toctree-l3"><a class="reference internal" href="../containers.html">Containers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../thread_local_storage.html">Thread Local Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exceptions.html">Exceptions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../nested-aux-interfaces.html">oneTBB Auxiliary Interfaces</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneVPL/source/index.html">oneVPL 0.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneMKL/source/index.html">oneMKL 0.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contributors.html">Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../versions.html">HTML and PDF Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notices.html">Legal Notices and Disclaimers</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">oneAPI Specification</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">oneAPI Specification</a> &raquo;</li>
        
          
          <li><a href="../nested-index.html">oneTBB 0.7</a> </li>
          
        
          
        
          
        
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/oneapi-src/oneapi-spec/blob/master/source/elements/oneTBB/source/algorithms/parallel_reduce_func.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="parallel-reduce-template-function">
<h1>parallel_reduce Template Function<a class="headerlink" href="#parallel-reduce-template-function" title="Permalink to this headline">¶</a></h1>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Computes reduction over a range.</p>
</div>
<div class="section" id="header">
<h2>Header<a class="headerlink" href="#header" title="Permalink to this headline">¶</a></h2>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;tbb/parallel_reduce.h&quot;</span><span class="cp"></span>
</pre></div>
</div>
</div>
<div class="section" id="syntax">
<h2>Syntax<a class="headerlink" href="#syntax" title="Permalink to this headline">¶</a></h2>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Range</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Value</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Func</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Reduction</span><span class="o">&gt;</span>
<span class="n">Value</span> <span class="n">parallel_reduce</span><span class="p">(</span> <span class="k">const</span> <span class="n">Range</span><span class="o">&amp;</span> <span class="n">range</span><span class="p">,</span> <span class="k">const</span> <span class="n">Value</span><span class="o">&amp;</span> <span class="n">identity</span><span class="p">,</span>
                       <span class="k">const</span> <span class="n">Func</span><span class="o">&amp;</span> <span class="n">func</span><span class="p">,</span> <span class="k">const</span> <span class="n">Reduction</span><span class="o">&amp;</span> <span class="n">reduction</span><span class="p">,</span>
                       <span class="p">[,</span> <span class="n">partitioner</span><span class="p">[,</span> <span class="n">task_group_context</span><span class="o">&amp;</span> <span class="n">group</span><span class="p">]]</span> <span class="p">);</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Range</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Body</span><span class="o">&gt;</span>
<span class="kt">void</span> <span class="n">parallel_reduce</span><span class="p">(</span> <span class="k">const</span> <span class="n">Range</span><span class="o">&amp;</span> <span class="n">range</span><span class="p">,</span> <span class="n">Body</span><span class="o">&amp;</span> <span class="n">body</span>
                      <span class="p">[,</span> <span class="n">partitioner</span><span class="p">[,</span> <span class="n">task_group_context</span><span class="o">&amp;</span> <span class="n">group</span><span class="p">]]</span> <span class="p">);</span>
</pre></div>
</div>
<p>where the optional <code class="docutils literal notranslate"><span class="pre">partitioner</span></code> declares any of the partitioners as
shown in column 1 of the Partitioners table in the Partitioners section.</p>
</div>
<div class="section" id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">parallel_reduce</span></code> template has two forms. The functional form is
designed to be easy to use in conjunction with lambda expressions. The imperative
form is designed to minimize copying of data.</p>
<p>The functional form <code class="docutils literal notranslate"><span class="pre">parallel_reduce(range,</span> <span class="pre">identity,</span> <span class="pre">func,</span> <span class="pre">reduction)</span></code> performs a parallel reduction by applying <em>func</em> to
subranges in range and reducing the results using binary operator
<em>reduction</em>. It returns the result of the reduction. Parameter <em>func</em> and
<em>reduction</em> can be lambda expressions. The table below summarizes the type
requirements on the types of <em>identity</em>, <em>func</em>, and <em>reduction</em>.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 1%" />
<col style="width: 99%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="2"><p>Requirements for Func and Reduction: Pseudo-Signature, Semantics</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="2"><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">Value</span> <span class="pre">identity</span></code></dt><dd><p>Left identity element for <code class="docutils literal notranslate"><span class="pre">Func::operator()</span></code>.</p>
</dd>
</dl>
</td>
</tr>
<tr class="row-odd"><td colspan="2"><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">Value</span> <span class="pre">Func::operator()(const</span> <span class="pre">Range&amp;</span> <span class="pre">range,</span> <span class="pre">const</span> <span class="pre">Value&amp;</span> <span class="pre">x)</span> <span class="pre">const</span></code></dt><dd><p>Accumulate result for subrange, starting with initial value
<code class="docutils literal notranslate"><span class="pre">x</span></code>.</p>
</dd>
</dl>
</td>
</tr>
<tr class="row-even"><td colspan="2"><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">Value</span> <span class="pre">Reduction::operator()(const</span> <span class="pre">Value&amp;</span> <span class="pre">x,</span> <span class="pre">const</span> <span class="pre">Value&amp;</span> <span class="pre">y)</span> <span class="pre">const</span></code></dt><dd><p>Combine results <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code>.</p>
</dd>
</dl>
</td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
</tr>
</tbody>
</table>
<p>The imperative form <code class="docutils literal notranslate"><span class="pre">parallel_reduce(range,body)</span></code>
performs parallel reduction of <em>body</em> over each value in <em>range</em>. Type
<code class="docutils literal notranslate"><span class="pre">Range</span></code> must model the Range concept. The body must model the
requirements shown in the table below.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 1%" />
<col style="width: 99%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="2"><p>Requirements for parallel_reduce Body: Pseudo-Signature, Semantics</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="2"><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">Body::Body(</span> <span class="pre">Body&amp;,</span> <span class="pre">split</span> <span class="pre">)</span></code></dt><dd><p>Splitting constructor. Must be able to run concurrently with
<code class="docutils literal notranslate"><span class="pre">operator()</span></code> and method <code class="docutils literal notranslate"><span class="pre">join</span></code>.</p>
</dd>
</dl>
</td>
</tr>
<tr class="row-odd"><td colspan="2"><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">Body::~Body()</span></code></dt><dd><p>Destructor.</p>
</dd>
</dl>
</td>
</tr>
<tr class="row-even"><td colspan="2"><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">Body::operator()(const</span> <span class="pre">Range&amp;</span> <span class="pre">range)</span></code></dt><dd><p>Accumulate result for subrange.</p>
</dd>
</dl>
</td>
</tr>
<tr class="row-odd"><td colspan="2"><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">Body::join(</span> <span class="pre">Body&amp;</span> <span class="pre">rhs</span> <span class="pre">)</span></code></dt><dd><p>Join results. The result in rhs should be merged into the result
of <code class="docutils literal notranslate"><span class="pre">this</span></code>.</p>
</dd>
</dl>
</td>
</tr>
<tr class="row-even"><td></td>
<td></td>
</tr>
</tbody>
</table>
<p>A <code class="docutils literal notranslate"><span class="pre">parallel_reduce</span></code> recursively splits the range into subranges to
the point such that <code class="docutils literal notranslate"><span class="pre">is_divisible()</span></code> is false for each subrange. A
<code class="docutils literal notranslate"><span class="pre">parallel_reduce</span></code> uses the splitting constructor to make one or more
copies of the body for each thread. It may copy a body while the body’s
<code class="docutils literal notranslate"><span class="pre">operator()</span></code> or method join runs concurrently. You are responsible for
ensuring the safety of such concurrency. In typical usage, the safety requires no
extra effort.</p>
<p>When worker threads are available, <code class="docutils literal notranslate"><span class="pre">parallel_reduce</span></code> invokes the
splitting constructor for the body. For each such split of the body, it invokes
method join in order to merge the results from the bodies. Define join to update
this to represent the accumulated result for this and rhs. The reduction operation
should be associative, but does not have to be commutative. For a noncommutative
operation <em>op</em>, “<code class="docutils literal notranslate"><span class="pre">left.join(right)</span></code>” should update
<em>left</em> to be the result of <em>left op right</em>.</p>
<p>A body is split only if the range is split, but the converse is not necessarily
so. The figure below diagrams a sample execution of
<code class="docutils literal notranslate"><span class="pre">parallel_reduce</span></code>. The root represents the original body
b<sub>0</sub> being applied to the half-open interval [0,20). The range is
recursively split at each level into two subranges. The grain size for the example
is 5, which yields four leaf ranges. The slash marks (/) denote where copies
(b<sub>1</sub> and b<sub>2</sub>) of the body were created by the body splitting
constructor. Bodies b<sub>0</sub> and b<sub>1</sub> each evaluate one leaf. Body
b<sub>2</sub> evaluates leaf [10,15) and [15,20), in that order. On the way back up
the tree, <code class="docutils literal notranslate"><span class="pre">parallel_reduce</span></code> invokes b<sub>0</sub>.join(b<sub>1</sub>)
and b<sub>0</sub>.join(b<sub>2</sub>) to merge the results of the leaves.</p>
<p><strong>Execution of parallel_reduce over blocked_range&lt;int&gt;(0,20,5)</strong></p>
<img alt="../../../../_images/parll_red.jpg" src="../../../../_images/parll_red.jpg" />
<p>The figure above shows only one possible execution. Other valid executions include
splitting b<sub>2</sub> into b<sub>2</sub> and b<sub>3</sub>, or doing no splitting
at all. With no splitting, b<sub>0</sub> evaluates each leaf in left to right order,
with no calls to <code class="docutils literal notranslate"><span class="pre">join</span></code>. A given body always evaluates one or more
subranges in left to right order. For example, in the figure above, body
b<sub>2</sub> is guaranteed to evaluate [10,15) before [15,20). You may rely on the
left to right property for a given instance of a body. However, you must neither
rely on a particular choice of body splitting nor on the subranges processed by a
given body object being consecutive. <code class="docutils literal notranslate"><span class="pre">parallel_reduce</span></code> makes the
choice of body splitting nondeterministically.</p>
<p><strong>Example where Body b0 processes non-consecutive subranges.</strong></p>
<img alt="../../../../_images/non_consq_rng.jpg" src="../../../../_images/non_consq_rng.jpg" />
<p>The subranges evaluated by a given body are not consecutive if there is an
intervening <code class="docutils literal notranslate"><span class="pre">join</span></code>. The joined information represents processing of a
gap between evaluated subranges. The figure above shows such an example. The body
b<sub>0</sub> performs the following sequence of operations:</p>
<ul class="simple">
<li><p>b<sub>0</sub>( [0,5) )</p></li>
<li><p>b<sub>0</sub><code class="docutils literal notranslate"><span class="pre">.join</span></code>()( b<sub>1</sub> ) where b<sub>1</sub> has
already processed [5,10)</p></li>
<li><p>b<sub>0</sub>( [10,15) )</p></li>
<li><p>b<sub>0</sub>( [15,20) )</p></li>
</ul>
<p>In other words, body b<sub>0</sub> gathers information about all the leaf subranges
in left to right order, either by directly processing each leaf, or by a join
operation on a body that gathered information about one or more leaves in a similar
way. When no worker threads are available, <code class="docutils literal notranslate"><span class="pre">parallel_reduce</span></code> executes
sequentially from left to right in the same sense as for
<code class="docutils literal notranslate"><span class="pre">parallel_for</span></code>. Sequential execution never invokes the splitting
constructor or method join.</p>
<p>All overloads can be passed a <code class="docutils literal notranslate"><span class="pre">task_group_context</span></code> object so that the
algorithm’s tasks are executed in this group. By default the algorithm is executed
in a bound group of its own.</p>
<p><strong>Complexity</strong></p>
<p>If the range and body take <em>O(1)</em> space, and the range splits into nearly equal
pieces, then the space complexity is <em>O(P×log(N))</em>, where <em>N</em> is the
size of the range and P is the number of threads.</p>
</div>
<div class="section" id="example-imperative-form">
<h2>Example (Imperative Form)<a class="headerlink" href="#example-imperative-form" title="Permalink to this headline">¶</a></h2>
<p>The following code sums the values in an array.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;tbb/parallel_reduce.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;tbb/blocked_range.h&quot;</span><span class="cp"></span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">tbb</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">Sum</span> <span class="p">{</span>
    <span class="kt">float</span> <span class="n">value</span><span class="p">;</span>
    <span class="n">Sum</span><span class="p">()</span> <span class="o">:</span> <span class="n">value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">{}</span>
    <span class="n">Sum</span><span class="p">(</span> <span class="n">Sum</span><span class="o">&amp;</span> <span class="n">s</span><span class="p">,</span> <span class="n">split</span> <span class="p">)</span> <span class="p">{</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;}</span>
    <span class="kt">void</span> <span class="k">operator</span><span class="p">()(</span> <span class="k">const</span> <span class="n">blocked_range</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">*&gt;&amp;</span> <span class="n">r</span> <span class="p">)</span> <span class="p">{</span>
        <span class="kt">float</span> <span class="n">temp</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span> <span class="kt">float</span><span class="o">*</span> <span class="n">a</span><span class="o">=</span><span class="n">r</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">a</span><span class="o">!=</span><span class="n">r</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">a</span> <span class="p">)</span> <span class="p">{</span>
            <span class="n">temp</span> <span class="o">+=</span> <span class="o">*</span><span class="n">a</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">temp</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">void</span> <span class="n">join</span><span class="p">(</span> <span class="n">Sum</span><span class="o">&amp;</span> <span class="n">rhs</span> <span class="p">)</span> <span class="p">{</span><span class="n">value</span> <span class="o">+=</span> <span class="n">rhs</span><span class="p">.</span><span class="n">value</span><span class="p">;}</span>
<span class="p">};</span>

<span class="kt">float</span> <span class="nf">ParallelSum</span><span class="p">(</span> <span class="kt">float</span> <span class="n">array</span><span class="p">[],</span> <span class="kt">size_t</span> <span class="n">n</span> <span class="p">)</span> <span class="p">{</span>
    <span class="n">Sum</span> <span class="n">total</span><span class="p">;</span>
    <span class="n">parallel_reduce</span><span class="p">(</span> <span class="n">blocked_range</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">*&gt;</span><span class="p">(</span> <span class="n">array</span><span class="p">,</span> <span class="n">array</span><span class="o">+</span><span class="n">n</span> <span class="p">),</span>
                     <span class="n">total</span> <span class="p">);</span>
    <span class="k">return</span> <span class="n">total</span><span class="p">.</span><span class="n">value</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The example generalizes to reduction for any associative operation <em>op</em> as
follows:</p>
<ul class="simple">
<li><p>Replace occurrences of 0 with the identity element for <em>op</em></p></li>
<li><p>Replace occurrences of += with <em>op</em>= or its logical equivalent.</p></li>
<li><p>Change the name <code class="docutils literal notranslate"><span class="pre">Sum</span></code> to something more appropriate for <em>op</em>.</p></li>
</ul>
<p>The operation may be noncommutative. For example, <em>op</em> could be matrix
multiplication.</p>
</div>
<div class="section" id="example-with-lambda-expressions">
<h2>Example with Lambda Expressions<a class="headerlink" href="#example-with-lambda-expressions" title="Permalink to this headline">¶</a></h2>
<p>The following is analogous to the previous example, but written using lambda
expressions and the functional form of <code class="docutils literal notranslate"><span class="pre">parallel_reduce</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;tbb/parallel_reduce.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;tbb/blocked_range.h&quot;</span><span class="cp"></span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">tbb</span><span class="p">;</span>

<span class="kt">float</span> <span class="nf">ParallelSum</span><span class="p">(</span> <span class="kt">float</span> <span class="n">array</span><span class="p">[],</span> <span class="kt">size_t</span> <span class="n">n</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">parallel_reduce</span><span class="p">(</span>
        <span class="n">blocked_range</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">*&gt;</span><span class="p">(</span> <span class="n">array</span><span class="p">,</span> <span class="n">array</span><span class="o">+</span><span class="n">n</span> <span class="p">),</span>
        <span class="mf">0.f</span><span class="p">,</span>
        <span class="p">[](</span><span class="k">const</span> <span class="n">blocked_range</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">*&gt;&amp;</span> <span class="n">r</span><span class="p">,</span> <span class="kt">float</span> <span class="n">init</span><span class="p">)</span><span class="o">-&gt;</span><span class="kt">float</span> <span class="p">{</span>
            <span class="k">for</span><span class="p">(</span> <span class="kt">float</span><span class="o">*</span> <span class="n">a</span><span class="o">=</span><span class="n">r</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">a</span><span class="o">!=</span><span class="n">r</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">a</span> <span class="p">)</span>
                <span class="n">init</span> <span class="o">+=</span> <span class="o">*</span><span class="n">a</span><span class="p">;</span>
            <span class="k">return</span> <span class="n">init</span><span class="p">;</span>
        <span class="p">},</span>
        <span class="p">[](</span> <span class="kt">float</span> <span class="n">x</span><span class="p">,</span> <span class="kt">float</span> <span class="n">y</span> <span class="p">)</span><span class="o">-&gt;</span><span class="kt">float</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>STL generalized numeric operations and functions objects can be used to write the
example more compactly as follows:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;numeric&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;functional&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;tbb/parallel_reduce.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;tbb/blocked_range.h&quot;</span><span class="cp"></span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">tbb</span><span class="p">;</span>

<span class="kt">float</span> <span class="nf">ParallelSum</span><span class="p">(</span> <span class="kt">float</span> <span class="n">array</span><span class="p">[],</span> <span class="kt">size_t</span> <span class="n">n</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">parallel_reduce</span><span class="p">(</span>
        <span class="n">blocked_range</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">*&gt;</span><span class="p">(</span> <span class="n">array</span><span class="p">,</span> <span class="n">array</span><span class="o">+</span><span class="n">n</span> <span class="p">),</span>
        <span class="mf">0.f</span><span class="p">,</span>
        <span class="p">[](</span><span class="k">const</span> <span class="n">blocked_range</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">*&gt;&amp;</span> <span class="n">r</span><span class="p">,</span> <span class="kt">float</span> <span class="n">value</span><span class="p">)</span><span class="o">-&gt;</span><span class="kt">float</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">accumulate</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="n">r</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="n">value</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="n">std</span><span class="o">::</span><span class="n">plus</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">()</span>
    <span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="parallel_deterministic_reduce_func.html" class="btn btn-neutral float-right" title="parallel_deterministic_reduce Template Function" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="parallel_for_func.html" class="btn btn-neutral float-left" title="parallel_for Template Function" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Intel Corporation

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>