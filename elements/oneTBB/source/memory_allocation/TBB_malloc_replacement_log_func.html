

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>TBB_malloc_replacement_log Function &mdash; oneAPI Specification 0.7 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../../_static/favicons.png"/>
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/language_data.js"></script>
        <script src="../../../../_static/custom.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Synchronization" href="../synchronization.html" />
    <link rel="prev" title="cache_aligned_resource Class" href="cache_aligned_resource_cls.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="https://oneapi.com" class="icon icon-home"> oneAPI Specification
          

          
            
            <img src="../../../../_static/oneAPI-rgb-rev-100.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.7
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../architecture.html">Software Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../library-interop.html">Library Interoperability</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../elements.html">oneAPI Elements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dpcpp/source/index.html">DPC++ 0.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneDPL/source/index.html">oneDPL 0.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneDNN/source/index.html">oneDNN 0.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneCCL/source/index.html">oneCCL 0.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../l0/source/index.html">Level Zero 0.91</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneDAL/source/index.html">oneDAL 0.7</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../nested-index.html">oneTBB 0.7</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../nested-gen-info.html">General Information</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nested-interfaces.html">oneTBB Interfaces</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../nested-aux-interfaces.html">oneTBB Auxiliary Interfaces</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../memory_allocation.html">Memory Allocation</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="c_interface_to_scalable_allocator.html">C Interface to Scalable Allocator</a></li>
<li class="toctree-l4"><a class="reference internal" href="allocator_concept.html">Allocator Concept</a></li>
<li class="toctree-l4"><a class="reference internal" href="memory_resource_interface.html">Memory Resource Interface</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">TBB_malloc_replacement_log Function</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../synchronization.html">Synchronization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../timing.html">Timing</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneVPL/source/index.html">oneVPL 0.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../oneMKL/source/index.html">oneMKL 0.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contributors.html">Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../versions.html">HTML and PDF Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notices.html">Legal Notices and Disclaimers</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">oneAPI Specification</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">oneAPI Specification</a> &raquo;</li>
        
          
          <li><a href="../nested-index.html">oneTBB 0.7</a> </li>
          
        
          
        
          
        
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/oneapi-src/oneapi-spec/blob/master/source/elements/oneTBB/source/memory_allocation/TBB_malloc_replacement_log_func.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="tbb-malloc-replacement-log-function">
<h1>TBB_malloc_replacement_log Function<a class="headerlink" href="#tbb-malloc-replacement-log-function" title="Permalink to this headline">¶</a></h1>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Function that provides information about the status
of dynamic memory allocation replacement (Windows* OS only).</p>
</div>
<div class="section" id="syntax">
<h2>Syntax<a class="headerlink" href="#syntax" title="Permalink to this headline">¶</a></h2>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">extern</span> <span class="s">&quot;C&quot;</span> <span class="kt">int</span> <span class="n">TBB_malloc_replacement_log</span><span class="p">(</span><span class="kt">char</span> <span class="o">***</span> <span class="n">log_ptr</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="header">
<h2>Header<a class="headerlink" href="#header" title="Permalink to this headline">¶</a></h2>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;tbb/tbbmalloc_proxy.h&quot;</span><span class="cp"></span>
</pre></div>
</div>
</div>
<div class="section" id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>Dynamic replacement of memory allocation functions on Windows* OS
uses in-memory binary instrumentation techniques. To ensure that such instrumentation is safe,
TBB first searches for a subset of replaced functions in the Visual C++* runtime DLLs,
and checks if each one has a known bytecode pattern. If any required function is not found
or its bytecode pattern is unknown, the replacement is skipped, and the program continues
to use the standard memory allocation functions.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">TBB_malloc_replacement_log</span></code> function allows the program
to check if the dynamic memory replacement has happened, and to get a log of the performed checks.</p>
<p><strong>Returns:</strong>
0 if all necessary functions were successfully found and the replacement took place, otherwise -1.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">log_ptr</span></code> parameter must be an address of
a <code class="docutils literal notranslate"><span class="pre">char**</span></code> variable, or be NULL. If it is not NULL, the function
writes there the address of an array of NULL-terminated strings containing detailed
information about the searched functions in the following format:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="nl">search_status</span><span class="p">:</span> <span class="n">function_name</span> <span class="p">(</span><span class="n">dll_name</span><span class="p">),</span> <span class="n">byte</span> <span class="nl">pattern</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">bytecodes</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>For more information about the replacement of dynamic memory allocation functions,
see “Windows* OS C/C++ Dynamic Memory Interface Replacement” section in the TBB Developer Guide.</p>
</div>
<div class="section" id="usage-example">
<h2>Usage example<a class="headerlink" href="#usage-example" title="Permalink to this headline">¶</a></h2>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;tbb/tbbmalloc_proxy.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="kt">char</span> <span class="o">**</span><span class="n">func_replacement_log</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">func_replacement_status</span> <span class="o">=</span> <span class="n">TBB_malloc_replacement_log</span><span class="p">(</span><span class="o">&amp;</span><span class="n">func_replacement_log</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">func_replacement_status</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;tbbmalloc_proxy cannot replace memory allocation routines</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">char</span><span class="o">**</span> <span class="n">log_string</span> <span class="o">=</span> <span class="n">func_replacement_log</span><span class="p">;</span> <span class="o">*</span><span class="n">log_string</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">log_string</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="o">*</span><span class="n">log_string</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Example output:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">tbbmalloc_proxy</span> <span class="n">cannot</span> <span class="n">replace</span> <span class="n">memory</span> <span class="n">allocation</span> <span class="n">routines</span>
<span class="nl">Success</span><span class="p">:</span> <span class="n">free</span> <span class="p">(</span><span class="n">ucrtbase</span><span class="p">.</span><span class="n">dll</span><span class="p">),</span> <span class="n">byte</span> <span class="nl">pattern</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">C7442410000000008B4424</span><span class="o">&gt;</span>
<span class="nl">Fail</span><span class="p">:</span> <span class="n">_msize</span> <span class="p">(</span><span class="n">ucrtbase</span><span class="p">.</span><span class="n">dll</span><span class="p">),</span> <span class="n">byte</span> <span class="nl">pattern</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">E90B000000CCCCCCCCCCCC</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../synchronization.html" class="btn btn-neutral float-right" title="Synchronization" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="cache_aligned_resource_cls.html" class="btn btn-neutral float-left" title="cache_aligned_resource Class" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Intel Corporation

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>